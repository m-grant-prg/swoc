<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Server Wait On Clients System - Full Internal Documentation: AutoTools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Server Wait On Clients System - Full Internal Documentation
   &#160;<span id="projectnumber">v1.7.2</span>
   </div>
   <div id="projectbrief">Server Wait On Clients System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_doxygen_src_150_autotools_internal.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AutoTools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#bootstrapping">Bootstrapping The Project</a></li>
<li class="level1"><a href="#gnulib">gnulib</a></li>
<li class="level1"><a href="#header_naming">Header File Naming Considerations</a><ul><li class="level2"><a href="#internal_header_naming">Internal</a></li>
<li class="level2"><a href="#api_header_naming">API</a></li>
</ul>
</li>
<li class="level1"><a href="#temporaries">Temporary Headers and Libraries</a><ul><li class="level2"><a href="#concept">Concept</a></li>
<li class="level2"><a href="#header_components">Header Components</a><ul><li class="level3"><a href="#header_directory_structure">Header Directory Structure</a></li>
<li class="level3"><a href="#header_build">Header Build</a></li>
<li class="level3"><a href="#header_consumption">Header Consumption</a></li>
</ul>
</li>
<li class="level2"><a href="#library_components">Library Components</a><ul><li class="level3"><a href="#library_directory_structure">Library Directory Structure</a></li>
<li class="level3"><a href="#library_buid">Library Build</a></li>
<li class="level3"><a href="#library_consumption">Library Consumption</a></li>
<li class="level3"><a href="#linking_verification">Linking Verification</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#linking_internal_libraries">Linking Internal Libraries</a></li>
<li class="level1"><a href="#installation_condiderations">Installation Considerations</a><ul><li class="level2"><a href="#ldconfig">Making Libraries Available</a></li>
<li class="level2"><a href="#doc_base">doc-base Documentation</a></li>
</ul>
</li>
<li class="level1"><a href="#troubleshooting">Troubleshooting</a><ul><li class="level2"><a href="#automake_or_libtool_bug">Automake or Libtool Bug</a><ul><li class="level3"><a href="#affected_environments">Affected Environments</a></li>
<li class="level3"><a href="#the_issue">The Issue</a></li>
<li class="level3"><a href="#workarounds">Workarounds</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="overview"></a>
Overview</h1>
<p>This documentation covers some important aspects of the AutoTools project structure and build.</p>
<h1><a class="anchor" id="bootstrapping"></a>
Bootstrapping The Project</h1>
<p>A bash script called bootstrap.sh is provided in the project root directory. It is a helper script to build the project. Apart from the core configure and make it has options to run the analyzer, make check, run sparse, use debugging flags etc. Rather than duplicate documentation here, please see the acmbuild wiki. (acmbuild.sh is just a wrapper to bootstrap.sh and takes all the same arguments). The wiki can be found at:-</p>
<p><a href="https://github.com/m-grant-prg/acmbuild/wiki">https://github.com/m-grant-prg/acmbuild/wiki</a></p>
<h1><a class="anchor" id="gnulib"></a>
gnulib</h1>
<p>The initial gnulib setup is performed by the script gen-gnulib.sh located in the project root directory. See the script itself for more information. For this project, invoking it from the project root directory would take the form:-</p>
<div class="fragment"><div class="line">gnulib-tool --import --source-base=src/prg/c/gen/lib \</div>
<div class="line">    --no-conditional-dependencies --no-libtool configmake</div>
</div><!-- fragment --><p>Files generated by the configmake modules in src/prg/c/gen/inc are not tracked in git but those in m4 and src/prg/c/gen/lib are. This allows people to work from a source tarball or a git clone without having to install gnulib and running gnulib-tool. It also enables straight forward builds of the project in packaging environments such as; pbuilder and LaunchPad, and, osc and openSUSE Build Service. This is described as option 3 on:-</p>
<p><a href="https://www.gnu.org/software/gnulib/manual/html_node/VCS-Issues.html">https://www.gnu.org/software/gnulib/manual/html_node/VCS-Issues.html</a></p>
<p>The bootstrap.sh script has a -g option which will perform a:- </p><pre class="fragment">gnulib-tool --update    # If you have gnulib installed.
</pre><p> The gnulib files committed are updated by the repo owner from the latest version he has installed.</p>
<h1><a class="anchor" id="header_naming"></a>
Header File Naming Considerations</h1>
<h2><a class="anchor" id="internal_header_naming"></a>
Internal</h2>
<p>Internal header files can have any name due to the current directory lookup of "".</p>
<h2><a class="anchor" id="api_header_naming"></a>
API</h2>
<p>If headers are installed in includedir the name should be as unique as possible due to the large potential for name clashes, namespacing would help.</p>
<p>If headers are installed in pkgincludedir and a pkg-config file is supplied then the situation is like the above since the pkg-config file supplies the compiler with the Cflags of pkgincludedir. So, the compiler command line will have both -I${includedir} and -I${pkgincludedir} making a large pool.</p>
<p>If headers are installed in pkgincludedir and all <code>#includes</code> use ${PACKAGE}/example.h then the names can be anything.</p>
<h1><a class="anchor" id="temporaries"></a>
Temporary Headers and Libraries</h1>
<h2><a class="anchor" id="concept"></a>
Concept</h2>
<p>The Temporary Header / Library concept is designed for use when an application (or library) is in concurrent development with a library on which it depends.</p>
<p>The library and headers which form the dependency can be copied here from an external project and linked against, thus testing the inter-action between the two.</p>
<p>Multiple libraries can be handled in this fashion with each library having it's own directory.</p>
<h2><a class="anchor" id="header_components"></a>
Header Components</h2>
<h3><a class="anchor" id="header_directory_structure"></a>
Header Directory Structure</h3>
<p>The header files should be located depending on how they are installed. So, if installed in includedir then the header will be in inc-tmp, if pkgincludedir then in a subdirectory named after the package. This is also how they are referenced in code, for example:-</p>
<div class="fragment"><div class="line">#include &lt;mge-portabilty.h&gt;</div>
<div class="line">vs</div>
<div class="line">#include &lt;libmgec/mge-portability.h&gt;</div>
</div><!-- fragment --><p>The resulting structure would look something like:-</p>
<div class="fragment"><div class="line">inc-tmp:</div>
<div class="line">total 40</div>
<div class="line">drwxr-xr-x 3 mgrantprg mgrantprg  4096 Sep 26 13:50 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Aug 16 10:09 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg     7 Sep 12 15:02 .gitignore</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 09:38 libmgec</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  1470 Sep 12 15:02 Makefile.am</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 16945 Sep 26 13:50 Makefile.in</div>
<div class="line"> </div>
<div class="line">inc-tmp/libmgec:</div>
<div class="line">total 44</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 09:38 .</div>
<div class="line">drwxr-xr-x 3 mgrantprg mgrantprg 4096 Sep 26 13:50 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2361 Sep 16 14:54 dllist.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 1447 Sep 16 14:54 libmgec.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 3658 Sep 16 14:55 mge-bstree.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2469 Sep 16 14:56 mge-buffer.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2601 Sep 16 14:56 mge-errno.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 1232 Sep 16 14:57 mge-memory.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2989 Sep 16 14:58 mge-message.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 1948 Sep 16 14:58 mge-portability.h</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2571 Sep 16 15:19 sllist.h</div>
</div><!-- fragment --><h3><a class="anchor" id="header_build"></a>
Header Build</h3>
<p>configure.ac provides the inc-tmp Makefile.am with the variable tmpheaders. This contains a space separated list of relative (to inc-tmp) paths to each temporary header file.</p>
<p>In addition, configure.ac checking of availability of such a header using AC_HEADER_CHECK is conditional on it not being present in inc-tmp.</p>
<h3><a class="anchor" id="header_consumption"></a>
Header Consumption</h3>
<p>As mentioned above, the C include directives are the same for an installed package and for temporary headers.</p>
<p>Consumption is facilitated in each Makefile.am via the C pre-processor flags xxxxxx_CPPFLAGS. A typical example would be:-</p>
<div class="fragment"><div class="line">if DEBUG</div>
<div class="line">AM_CPPFLAGS = $(MG_DEBUG_CPPFLAGS)</div>
<div class="line">else</div>
<div class="line">AM_CPPFLAGS = $(MG_CPPFLAGS)</div>
<div class="line">endif</div>
<div class="line">AM_CPPFLAGS += -I$(srcdir)/../../inc-tmp -I$(srcdir)/../../inc</div>
<div class="line">AM_CPPFLAGS += -I../../gen/inc -I../../gen/lib</div>
</div><!-- fragment --><h2><a class="anchor" id="library_components"></a>
Library Components</h2>
<h3><a class="anchor" id="library_directory_structure"></a>
Library Directory Structure</h3>
<p>The files for each library should be copied to their own directory under lib-tmp including the hidden .libs directory. The resulting directory structure would look something like:-</p>
<div class="fragment"><div class="line">lib-tmp:</div>
<div class="line">total 44</div>
<div class="line">drwxr-xr-x 3 mgrantprg mgrantprg  4096 Sep 26 09:34  .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Aug 16 10:09  ..</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Sep 19 15:30  libmgec</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  4506 Aug 16 10:09 &#39;lib-tmp usage.txt&#39;</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  1125 Aug 16 10:09  Makefile.am</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 14486 Sep 26 09:17  Makefile.in</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec:</div>
<div class="line">total 100</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 3 mgrantprg mgrantprg  4096 Sep 26 09:34 ..</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 buf-msg</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .deps</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 errors</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   354 Sep  7 15:44 .gitignore</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   931 Sep 19 15:24 libmgec.la</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   322 Sep 19 15:24 libmgec_la-version.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 55384 Sep 19 15:24 libmgec_la-version.o</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .libs</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 listsandsorts</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 memory</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/buf-msg:</div>
<div class="line">total 200</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .deps</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg     0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   327 Sep 19 15:24 libmgec_la-buffer.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85776 Sep 19 15:24 libmgec_la-buffer.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   330 Sep 19 15:24 libmgec_la-message.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 90944 Sep 19 15:24 libmgec_la-message.o</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .libs</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/buf-msg/.deps:</div>
<div class="line">total 24</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg 4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6404 Sep 19 15:24 libmgec_la-buffer.Plo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6943 Sep 19 15:24 libmgec_la-message.Plo</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/buf-msg/.libs:</div>
<div class="line">total 184</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85744 Sep 19 15:24 libmgec_la-buffer.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 90920 Sep 19 15:24 libmgec_la-message.o</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/.deps:</div>
<div class="line">total 12</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg 4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 2625 Sep 19 15:24 libmgec_la-version.Plo</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/errors:</div>
<div class="line">total 188</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg   4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg   4096 Sep 19 15:30 ..</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg   4096 Sep 19 15:30 .deps</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg      0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    323 Sep 19 15:24 libmgec_la-errno.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  60104 Sep 19 15:24 libmgec_la-errno.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    323 Sep 19 15:24 libmgec_la-error.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 105648 Sep 19 15:24 libmgec_la-error.o</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg   4096 Sep 19 15:30 .libs</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/errors/.deps:</div>
<div class="line">total 20</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg 4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 3948 Sep 19 15:24 libmgec_la-errno.Plo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 7346 Sep 19 15:24 libmgec_la-error.Plo</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/errors/.libs:</div>
<div class="line">total 172</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg   4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg   4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  60072 Sep 19 15:24 libmgec_la-errno.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 105616 Sep 19 15:24 libmgec_la-error.o</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/.libs:</div>
<div class="line">total 1044</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg   4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg   4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 752278 Sep 19 15:24 libmgec.a</div>
<div class="line">lrwxrwxrwx 1 mgrantprg mgrantprg     13 Sep 19 15:30 libmgec.la -&gt; ../libmgec.la</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    932 Sep 19 15:24 libmgec.lai</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg  55352 Sep 19 15:24 libmgec_la-version.o</div>
<div class="line">lrwxrwxrwx 1 mgrantprg mgrantprg     16 Sep 19 15:30 libmgec.so -&gt; libmgec.so.7.0.0</div>
<div class="line">lrwxrwxrwx 1 mgrantprg mgrantprg     16 Sep 19 09:40 libmgec.so.2 -&gt; libmgec.so.2.4.1</div>
<div class="line">-rwxr-xr-x 1 mgrantprg mgrantprg 120168 Sep 19 09:36 libmgec.so.2.4.1</div>
<div class="line">lrwxrwxrwx 1 mgrantprg mgrantprg     16 Sep 19 15:30 libmgec.so.7 -&gt; libmgec.so.7.0.0</div>
<div class="line">-rwxr-xr-x 1 mgrantprg mgrantprg 120168 Sep 19 15:24 libmgec.so.7.0.0</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/listsandsorts:</div>
<div class="line">total 292</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .deps</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg     0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   333 Sep 19 15:24 libmgec_la-bstree.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 97576 Sep 19 15:24 libmgec_la-bstree.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   333 Sep 19 15:24 libmgec_la-dllist.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 84384 Sep 19 15:24 libmgec_la-dllist.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   333 Sep 19 15:24 libmgec_la-sllist.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85864 Sep 19 15:24 libmgec_la-sllist.o</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .libs</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/listsandsorts/.deps:</div>
<div class="line">total 32</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg 4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6428 Sep 19 15:24 libmgec_la-bstree.Plo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6286 Sep 19 15:24 libmgec_la-dllist.Plo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6286 Sep 19 15:24 libmgec_la-sllist.Plo</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/listsandsorts/.libs:</div>
<div class="line">total 272</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 97672 Sep 19 15:24 libmgec_la-bstree.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 84408 Sep 19 15:24 libmgec_la-dllist.o</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85928 Sep 19 15:24 libmgec_la-sllist.o</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/memory:</div>
<div class="line">total 104</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 8 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .deps</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg     0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg   326 Sep 19 15:24 libmgec_la-memory.lo</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85088 Sep 19 15:24 libmgec_la-memory.o</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .libs</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/memory/.deps:</div>
<div class="line">total 16</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg 4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg 4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg    0 Sep 19 15:24 .dirstamp</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 6517 Sep 19 15:24 libmgec_la-memory.Plo</div>
<div class="line"> </div>
<div class="line">lib-tmp/libmgec/memory/.libs:</div>
<div class="line">total 92</div>
<div class="line">drwxr-xr-x 2 mgrantprg mgrantprg  4096 Sep 19 15:30 .</div>
<div class="line">drwxr-xr-x 4 mgrantprg mgrantprg  4096 Sep 19 15:30 ..</div>
<div class="line">-rw-r--r-- 1 mgrantprg mgrantprg 85064 Sep 19 15:24 libmgec_la-memory.o</div>
</div><!-- fragment --><h3><a class="anchor" id="library_buid"></a>
Library Build</h3>
<p>configure.ac provides Makefile.am's with a variable tmplibraries. This variable contains a space separated list of the absolute paths of all libraries under lib-tmp.</p>
<p>In addition, configure.ac checks the availability of such libraries in strict order of lib-tmp, PKG_CHECK_MODULES and lastly AC_SEARCH_LIBS.</p>
<h3><a class="anchor" id="library_consumption"></a>
Library Consumption</h3>
<p>To be able to LINK against any temporary libraries, the Makefile.am must have the following line:-</p>
<div class="fragment"><div class="line">Usually:-</div>
<div class="line">LDADD = $(tmplibraries)</div>
<div class="line">or with the Product Option Variable can be:-</div>
<div class="line">xxxxxxxxx_LDADD = $(tmplibraries)</div>
</div><!-- fragment --><p>N.B.</p>
<p>LDADD as opposed to xxxxxxxxx_LDFLAGS must be used as LDFLAGS does not necessarily set the search path variable LD_LIBRARY_PATH in the desired order, the standard location may precede our temporary library location in the search path.</p>
<h3><a class="anchor" id="linking_verification"></a>
Linking Verification</h3>
<p>It can be useful to be able to prove which libraries are being used in a libtool environment. ldd may be the first thought however it can be quite misleading, as shown run against a project library project test program:-</p>
<div class="fragment"><div class="line">mgrantprg@leonidas:~/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs$ ldd ./configfiletest</div>
<div class="line">    linux-vdso.so.1 (0x00007ffeecfcb000)</div>
<div class="line">    libmgesysutils.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libmgesysutils.so.1 (0x00007f8ca17ca000)</div>
<div class="line">    libmgec.so.7 =&gt; not found</div>
<div class="line">    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8ca15f5000)</div>
<div class="line">    libmgec.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libmgec.so.2 (0x00007f8ca15ee000)</div>
<div class="line">    /lib64/ld-linux-x86-64.so.2 (0x00007f8ca17ed000)</div>
<div class="line">mgrantprg@leonidas:~/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs$</div>
</div><!-- fragment --><p>The answer is to switch on debugging. This produces voluminous output but near the end of one of the output files you will find the inits and finis for the libraries it is using. (See man 8 ld.so).</p>
<div class="fragment"><div class="line">LD_DEBUG=all LD_DEBUG_OUTPUT=mg ./configfiletest</div>
<div class="line"> </div>
<div class="line">TL;DR</div>
<div class="line">&lt;snip&gt;</div>
<div class="line">     10015: calling init: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/src/prg/c/lib-tmp/libmgec/.libs/libmgec.so.7</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: calling init: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs/libmgesysutils.so.1</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: initialize program: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs/configfiletest</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: transferring control: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs/configfiletest</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs/configfiletest [0]</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs/libmgesysutils.so.1 [0]</div>
<div class="line">     10015:</div>
<div class="line">     10015:</div>
<div class="line">     10015: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/src/prg/c/lib-tmp/libmgec/.libs/libmgec.so.7 [0]</div>
<div class="line"> </div>
<div class="line">&lt;/snip&gt;</div>
</div><!-- fragment --><p>Simplify the search by:-</p>
<div class="fragment"><div class="line">mgrantprg@leonidas:~/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile$ grep -hw &#39;init\|fini&#39; mg.* | grep &#39;mge&#39;</div>
<div class="line">     42577: calling init: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/src/prg/c/lib-tmp/libmgec/.libs/libmgec.so.7</div>
<div class="line">     42577: calling init: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs/libmgesysutils.so.1</div>
<div class="line">     42577: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile/.libs/configfiletest [0]</div>
<div class="line">     42577: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs/libmgesysutils.so.1 [0]</div>
<div class="line">     42577: calling fini: /home/mgrantprg/SWDev/Projects/C/libmgesysutils/src/prg/c/lib-tmp/libmgec/.libs/libmgec.so.7 [0]</div>
<div class="line">mgrantprg@leonidas:~/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/test-configfile$</div>
</div><!-- fragment --><p>So, for libraries go to the .libs directory and use ldd ./library.so and for executables use the debugging shown above.</p>
<h1><a class="anchor" id="linking_internal_libraries"></a>
Linking Internal Libraries</h1>
<p>Take the scenario where you have written a test program for a project library. Now the previous stable release may be installed on your machine. You do not want to link against that library but the one in development. To achieve this place the following in the test program Makefile.am:-</p>
<p>LDADD = ../libmgesysutils/libmgesysutils.la</p>
<h1><a class="anchor" id="installation_condiderations"></a>
Installation Considerations</h1>
<p>Installation instructions can be found in the README file at:-</p>
<p><a href="https://github.com/m-grant-prg/swoc">https://github.com/m-grant-prg/swoc</a></p>
<p>and on the wiki:-</p>
<p><a href="https://github.com/m-grant-prg/swoc/wiki">https://github.com/m-grant-prg/swoc/wiki</a></p>
<h2><a class="anchor" id="ldconfig"></a>
Making Libraries Available</h2>
<p>Having installed shared libraries it is necessary to run ldconfig to refresh links and cache. This cannot be automatically included in the installation as it will cause downstream package builds to fail when trying to access files (/etc) outside their chroot. It is easier to ask that this be run manually after 'make install'.</p>
<h2><a class="anchor" id="doc_base"></a>
doc-base Documentation</h2>
<p>This package produces documentation designed to be registered with scrollkeeper and dochelp. The problem arises when it is required to have an AT installation and a package manager installation residing in parallel. In the case of doc-base this would mean installing 2 sets of documentation with the same docid. Needless to say doc-base does not like this.</p>
<p>The solution is not to automatically install the doc-base documents unless specifically asked to do so with the &ndash;enable-atonly argument supplied to configure.</p>
<h1><a class="anchor" id="troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="automake_or_libtool_bug"></a>
Automake or Libtool Bug</h2>
<h3><a class="anchor" id="affected_environments"></a>
Affected Environments</h3>
<p>The issues discussed in this document concern the packages specified below as supplied by Debian Bookworm:-</p>
<div class="fragment"><div class="line">autoconf 2.71-3</div>
<div class="line">automake 1:1.16.5-1.3</div>
<div class="line">libtool 2.4.7-5</div>
</div><!-- fragment --><p>The problems may exist in other versions and / or versions shipped with other distributions. This has not been investigated.</p>
<h3><a class="anchor" id="the_issue"></a>
The Issue</h3>
<p>If the test program Makefile.am references another library, perhaps via the linker flags, e.g.:-</p>
<div class="fragment"><div class="line">AM_LDFLAGS = $(MG_LDFLAGS)</div>
<div class="line">AM_LDFLAGS += $(LIBMGEC_LIBS)</div>
</div><!-- fragment --><p>Then LD_LIBRARY_PATH must point at the path for system-wide libraries as well as the local AT library path. Unfortunately a bug in Automake and / or Libtool causes the LD_LIBRARY_PATH variable to be set incorrectly. It is generated as:-</p>
<div class="fragment"><div class="line">LD_LIBRARY_PATH=&quot;/usr/lib/x86_64-linux-gnu:/home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs:$LD_LIBRARY_PATH&quot;</div>
</div><!-- fragment --><p>This means that if the library being tested is already installed (whatever version), the test programs, when run through the libtool wrapper, will be run against that installed library with dodgy results. The line should read:-</p>
<div class="fragment"><div class="line">LD_LIBRARY_PATH=&quot;/home/mgrantprg/SWDev/Projects/C/libmgesysutils/atbuild/src/prg/c/src/libmgesysutils/.libs:/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="workarounds"></a>
Workarounds</h3>
<p>Whilst waiting for a proper permanent fix there are 2 possible workarounds:-</p>
<p>1) Fix the library variable.</p>
<p>2) Run in a container which does not have the library installed.</p>
<p><b>1 ... Fix the library variable</b></p>
<p>A script named fix-&lt;libtool-program-wrapper-name&gt;.sh is supplied for each test. e.g. For a test called messagestest the script would be fix-messagestest.sh.</p>
<p>These scripts perform a fairly basic reorganisation of the LD_LIBRARY_PATH variable. If the first entry starts "/usr" then this is moved to the end of the variable just before the ending ":$LD_LIBRARY_PATH". This process is repeated until the first element does not start with "/usr".</p>
<p>So, to just run the test from the test object directory:-</p>
<div class="fragment"><div class="line">./fix-messagestest.sh &amp;&amp; ./messagestest</div>
</div><!-- fragment --><p>to use gdb, run:-</p>
<div class="fragment"><div class="line">./fix-messagestest.sh &amp;&amp; libtool --mode=execute gdb --tui --tty=.dev.pts/&lt;X&gt; \</div>
<div class="line">    ./messagestest</div>
</div><!-- fragment --><p>and valgrind would be similar to the above.</p>
<p><b>2 ... Use a container</b></p>
<p>Obviously the container should not have the library installed.</p>
<p>The upside of using a container is that the libtool wrappers should just work, so all that would be required would be:- ./messagestest</p>
<div class="fragment"><div class="line">libtool &lt;etc etc&gt;........</div>
</div><!-- fragment --><p>The downside is that all the correct packages need to be installed which may mean significant container management. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
